<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/Ace2exam_Wa.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Ace2Examz - Your Path To Success! Premier Chemistry Coaching for NEET, JEE, IAT, NEST, CSIR NET, GATE, IIT JAM & TIFR" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap"
    rel="stylesheet">

  <!-- Zoho Campaigns Newsletter Scripts -->
  <script type="text/javascript" src="https://exmz-zc1.maillist-manage.in/js/optin.min.js"
    onload="setupSF('sf3z9a6c989be977e55a4b7314f1064d24923d8081c2d7b577011b09adb8de5640f9','ZCFORMVIEW',false,'light',false,'0')"></script>
  <script type="text/javascript">
    function runOnFormSubmit_sf3z9a6c989be977e55a4b7314f1064d24923d8081c2d7b577011b09adb8de5640f9(th) {
      /*Before submit, if you want to trigger your event, "include your code here"*/
    };
  </script>

  <!-- Custom CSS for OneSignal Bell Position -->
  <style>
    /* Position OneSignal bell button in bottom-left corner */
    .onesignal-bell-launcher,
    #onesignal-bell-container,
    .onesignal-bell-launcher-button,
    div[class*="onesignal-bell"]:not(.onesignal-bell-launcher-dialog):not(.onesignal-bell-launcher-dialog-body) {
      bottom: 20px !important;
      top: auto !important;
      left: 20px !important;
      right: auto !important;
      transform: none !important;
      position: fixed !important;
      width: 60px !important;
      height: 60px !important;
      max-width: 60px !important;
      max-height: 60px !important;
      min-width: 60px !important;
      min-height: 60px !important;
      z-index: 999999 !important;
      /* Highest z-index to stay on top of everything */
    }

    /* Size the bell icon itself */
    .onesignal-bell-launcher .onesignal-bell-launcher-button,
    .onesignal-bell-launcher svg,
    .onesignal-bell-launcher img {
      width: 60px !important;
      height: 60px !important;
    }

    /* Position the notification dialog to the RIGHT of the bell */
    .onesignal-bell-launcher-dialog,
    .onesignal-bell-launcher-dialog-body,
    div[class*="onesignal-bell-launcher-dialog"] {
      bottom: 20px !important;
      /* Same level as bell */
      top: auto !important;
      left: 100px !important;
      /* To the right: 20px + 60px + 20px spacing */
      right: auto !important;
      transform: none !important;
      position: fixed !important;
      z-index: 999998 !important;
      /* Below bell but above everything else */
      max-width: 360px !important;
      width: 360px !important;
      min-height: 200px !important;
      /* Minimum height so it's visible */
      max-height: 450px !important;
      height: auto !important;
      /* Auto height to fit content */
      overflow-y: auto !important;
    }

    /* Ensure bell stays on top with maximum z-index */
    .onesignal-bell-launcher {
      z-index: 999999 !important;
    }

    /* Dialog below bell in z-index */
    .onesignal-bell-launcher-dialog {
      z-index: 999998 !important;
    }

    /* Make sure bell button is always clickable and visible */
    .onesignal-bell-launcher-button {
      pointer-events: auto !important;
      z-index: 999999 !important;
      background: rgba(0, 0, 0, 0.8) !important;
      border-radius: 50% !important;
      cursor: pointer !important;
    }
  </style>

  <!-- OneSignal Push Notifications -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function (OneSignal) {
      try {
        console.log('[OneSignal] üöÄ Starting initialization...');

        await OneSignal.init({
          appId: "f19678f2-4968-4172-b5a8-7854008c21b0",
          safari_web_id: "web.onesignal.auto.41b6a3ea-cfe2-480b-805a-97ab17a018f3",
          notifyButton: {
            enable: true,
            size: 'medium',
            position: 'bottom-left',
            showCredit: false,
          },
          allowLocalhostAsSecureOrigin: true,
        });

        console.log('[OneSignal] ‚úÖ Initialized successfully');
        console.log('[OneSignal] App ID:', "f19678f2-4968-4172-b5a8-7854008c21b0");

        // Custom notification storage
        const getStoredNotifications = () => {
          try {
            return JSON.parse(localStorage.getItem('customNotifications') || '[]');
          } catch {
            return [];
          }
        };

        const storeNotification = (notification) => {
          const notifications = getStoredNotifications();
          notifications.unshift({
            id: notification.notificationId || Date.now(),
            title: notification.title,
            body: notification.body,
            timestamp: Date.now(),
            read: false
          });
          // Keep only last 20 notifications
          if (notifications.length > 20) notifications.pop();
          localStorage.setItem('customNotifications', JSON.stringify(notifications));
        };

        // Check subscription status
        const optedIn = await OneSignal.User.PushSubscription.optedIn;
        console.log('[OneSignal] User opted in:', optedIn);

        if (optedIn) {
          const subscriptionId = await OneSignal.User.PushSubscription.id;
          console.log('[OneSignal] Subscription ID:', subscriptionId);
          const userId = await OneSignal.User.id;
          console.log('[OneSignal] User ID:', userId);
        } else {
          console.log('[OneSignal] ‚ö†Ô∏è User not subscribed. Click the bell icon to subscribe.');
        }

        // Listen for subscription changes
        OneSignal.User.PushSubscription.addEventListener('change', (event) => {
          console.log('[OneSignal] üîî Subscription changed:', event);
          console.log('[OneSignal] New subscription status:', event.current.optedIn);
        });

        // Listen for notification display and store it
        OneSignal.Notifications.addEventListener('foregroundWillDisplay', (event) => {
          console.log('[OneSignal] üì¨ Notification received:', event.notification);
          storeNotification(event.notification);
        });

        // Listen for notification click
        OneSignal.Notifications.addEventListener('click', (event) => {
          console.log('[OneSignal] üëÜ Notification clicked:', event.notification);
        });

        // Create custom notification panel
        const createCustomNotificationPanel = () => {
          const panel = document.createElement('div');
          panel.id = 'custom-notification-panel';
          panel.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 100px;
            width: 360px;
            max-height: 450px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 999997;
            display: none;
            overflow: hidden;
          `;

          const header = document.createElement('div');
          header.style.cssText = `
            padding: 16px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
          `;
          header.innerHTML = `
            <span>Notifications</span>
            <button onclick="document.getElementById('custom-notification-panel').style.display='none'" 
                    style="border:none;background:none;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;">√ó</button>
          `;

          const content = document.createElement('div');
          content.id = 'notification-list';
          content.style.cssText = `
            max-height: 380px;
            overflow-y: auto;
          `;

          panel.appendChild(header);
          panel.appendChild(content);
          document.body.appendChild(panel);
          return panel;
        };

        const updateNotificationList = () => {
          const notifications = getStoredNotifications();
          const list = document.getElementById('notification-list');
          if (!list) return;

          if (notifications.length === 0) {
            list.innerHTML = '<div style="padding:20px;text-align:center;color:#999;">No notifications yet</div>';
            return;
          }

          list.innerHTML = notifications.map(notif => `
            <div style="padding:12px 16px;border-bottom:1px solid #eee;cursor:pointer;${notif.read ? 'opacity:0.6;' : ''}"
                 onmouseover="this.style.background='#f5f5f5'" 
                 onmouseout="this.style.background='white'">
              <div style="font-weight:bold;margin-bottom:4px;">${notif.title || 'Notification'}</div>
              <div style="font-size:14px;color:#666;margin-bottom:4px;">${notif.body || ''}</div>
              <div style="font-size:12px;color:#999;">${new Date(notif.timestamp).toLocaleString()}</div>
            </div>
          `).join('');
        };

        // Add click listener to bell button
        setTimeout(() => {
          const bellButton = document.querySelector('.onesignal-bell-launcher-button');
          const bellLauncher = document.querySelector('.onesignal-bell-launcher');

          if (bellButton || bellLauncher) {
            console.log('[OneSignal] ‚úÖ Bell button found!');

            // Create custom panel
            const customPanel = createCustomNotificationPanel();

            const clickHandler = async (e) => {
              e.stopPropagation();
              console.log('[OneSignal] üîî Bell button clicked!');

              const isSubscribed = await OneSignal.User.PushSubscription.optedIn;

              if (isSubscribed) {
                // Show custom notification panel
                const panel = document.getElementById('custom-notification-panel');
                if (panel.style.display === 'none' || !panel.style.display) {
                  updateNotificationList();
                  panel.style.display = 'block';
                } else {
                  panel.style.display = 'none';
                }
              } else {
                // Show subscription prompt
                await OneSignal.Slidedown.promptPush();
              }
            };

            if (bellButton) {
              bellButton.addEventListener('click', clickHandler, true);
            }
            if (bellLauncher) {
              bellLauncher.addEventListener('click', clickHandler, true);
            }
          }
        }, 3000);

      } catch (error) {
        console.error('[OneSignal] ‚ùå Initialization error:', error);
        console.error('[OneSignal] Error details:', error.message, error.stack);
      }
    });
  </script>

  <title>Ace2Examz | Your Path To Success - Premier Chemistry Coaching</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>

  <!-- Frillbot Chatbot Widget -->
  <script>
    window.chatpilotIframeConfig = {
      chatbotId: "09ab53ae7eec4078b03364a594c688af",
      domain: "https://bot.frillbot.com"
    }
  </script>
  <script src="https://bot.frillbot.com/embed.iframe.js" charset="utf-8"></script>

  <!-- Zoho SalesIQ Chat Widget -->
  <script>window.$zoho = window.$zoho || {}; $zoho.salesiq = $zoho.salesiq || { ready: function () { } }</script>
  <script id="zsiqscript"
    src="https://salesiq.zohopublic.in/widget?wc=siqdbcc2b03c10f8abbc3df039feed66993c517bd0e377a23ce7755db070ef77509"
    defer></script>
</body>

</html>